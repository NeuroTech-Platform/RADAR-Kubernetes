bases:
- ../environments.yaml

---

helmDefaults:
  atomic: false
  timeout: 240
  kubeContext: {{ .Values.kubeContext }}

repositories:
  - name: radar
    url: https://radar-base.github.io/radar-helm-charts

releases:
  - name: redis
    chart: radar/redis
    version: {{ .Values.redis._chart_version }}
    installed: {{ .Values.redis._install }}
    values:
      - "../etc/redis/values.yaml"
      - {{ .Values.redis | toYaml | indent 8 | trim }}

  - name: minio
    chart: radar/minio
    version: {{ .Values.minio._chart_version }}
    installed: {{ .Values.minio._install }}
    values:
      - "../etc/minio/values.yaml"
      - {{ .Values.minio | toYaml | indent 8 | trim }}
    set:
      - name: ingress.hosts
        values: ["s3.{{ .Values.server_name }}"]
      - name: ingress.tls[0].secretName
        value: radar-base-tls-s3
      - name: ingress.tls[0].hosts
        values: ["s3.{{ .Values.server_name }}"]
      - name: accessKey
        value: {{ .Values.s3_access_key }}
      - name: secretKey
        value: {{ .Values.s3_secret_key }}

  - name: radar-s3-connector
    chart: radar/radar-s3-connector
    version: {{ .Values.radar_s3_connector._chart_version }}
    installed: {{ .Values.radar_s3_connector._install }}
    values:
      - {{ .Values.radar_s3_connector | toYaml | indent 8 | trim }}
      - {{ .Values.confluent_cloud | toYaml | indent 8 | trim }}
    set:
      - name: cc.enabled
        value: {{ .Values.confluent_cloud.enabled }}
      - name: bucketAccessKey
        value: {{ .Values.s3_access_key }}
      - name: bucketSecretKey
        value: {{ .Values.s3_secret_key }}

  - name: s3-proxy
    chart: radar/s3-proxy
    version: {{ .Values.s3_proxy._chart_version }}
    installed: {{ .Values.s3_proxy._install }}
    values:
      - {{ .Values.s3_proxy | toYaml | indent 8 | trim }}
      - name: s3.identity
        value: {{ .Values.s3_access_key }}
      - name: s3.credential
        value: {{ .Values.s3_secret_key }}

  - name: radar-output
    chart: radar/radar-output
    version: {{ .Values.radar_output._chart_version }}
    wait: true
    installed: {{ .Values.radar_output._install }}
    values:
      - {{ .Values.radar_output | toYaml | indent 8 | trim }}
      - name: source.s3.accountName
        value: {{ .Values.s3_access_key }}
      - name: source.s3.accountKey
        value: {{ .Values.s3_secret_key }}
      - name: target.s3.accountName
        value: {{ .Values.s3_access_key }}
      - name: target.s3.accountKey
        value: {{ .Values.s3_secret_key }}
